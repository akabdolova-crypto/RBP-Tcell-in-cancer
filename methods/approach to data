Below is a concise “Methods”:

Input & pre-processing
- Matrix: 16,291 cells × 55,737 genes; 32 patients; 3 therapies; timepoints Pre/Post.
- Per cohort (therapy × timepoint), we filter genes detected in ≥3 cells; then compute highly variable genes (HVGs) for dimensionality reduction.

Linear embedding
- PCA on scaled HVGs → 50 PCs. These PCs summarize transcriptome variation and suppress noise.
- KNN graph on PCA space (30 PCs) using Euclidean distances; edges reflect local similarity.
	- Mathematically: build a neighborhood graph G=(V,E)G=(V,E) with adjacency AA, then normalize to connectivities (weights), typically symmetrized & renormalized (Scanpy pp.neighbors).

Nonlinear visualization
- UMAP on the KNN graph: UMAP optimizes a low‑dimensional embedding that preserves local topology by minimizing the cross-entropy between a fuzzy simplicial set in high‑D and low‑D. It’s purely for visualization (not statistics).
Exhaustion & RBP module scores
- Gene set scoring (Scanpy tl.score_genes) computes a per-cell z‑scored signature; we used (i) an exhaustion score and (ii) an RBP module (mean across present RBPs).

Diffusion Maps & DPT (pseudotime)
- We compute Diffusion Maps using nDC=15nDC=15 components.
	- Let PP be the Markov transition matrix from the KNN graph (row-normalized connectivities).
	- Eigen-decompose P=ΨΛΦ⊤P=ΨΛΦ⊤. The diffusion components (DCs) are columns of ΨΨ, ordered by eigenvalues λ1≥λ2≥⋯λ1≥λ2≥⋯. They parametrize low‑dimensional manifold geometry by random‑walk diffusion.
- DPT (Diffusion Pseudotime) measures a diffusion distance from a chosen root cell: roughly DPT(i)=∑k=2Kλkt(ψk(i)−ψk(root))2DPT(i)=∑k=2Kλkt(ψk(i)−ψk(root))2 for some kernel time tt (conceptually). The idea: if CTL→Tex progression is manifold-like and connected, DPT should increase monotonically from stem/TCF7-high through T‑CM/T‑EFF to intermediate/terminal Tex.
- Root selection should be a biologically early CD8 subset (TCF7/IL7R-high). If the graph is disconnected, DPT can become undefined or behave oddly (e.g., inf means or repeated 1.0/–1.0 eigenvalues).

Aggregation & statistics
- Patient‑level means (CD8-only options): we aggregate expression by patient (and later by CD8 stages) and compute mean ± SD across patients within each group (therapy × timepoint × response).
- Barplots compare Pre vs Post, Responder vs Non‑responder, and within CD8 stages.

